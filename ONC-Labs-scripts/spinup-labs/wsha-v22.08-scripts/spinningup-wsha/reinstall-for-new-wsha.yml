---
- name: Connect to WSHA to run script update
  hosts: restore_wsha_vm 

  vars_files:
    - ha_env_variables 

  tasks:
  - name: Copy openvpn profile
    copy:
      src: "{{rootProfile}}{{ vpnProfile }}/{{ wsha_profile_name }}"
      dest: /etc/openvpn3
    become: true

  - name: Connect VPN to WHLabs
    shell: |
      openvpn3 session-start --config /etc/openvpn3/{{ wsha_profile_name }}
    become_user: WSHA_Admin
    become: true
    become_method: su
    become_flags: '-s /bin/bash'

  - name: Check vpn connaction with NFMT
    shell: openvpn3 sessions-list 
    register: showConnection

  - name: List VPN connections
    debug:
      msg: "{{showConnection.stdout}}"
               
  - name: Run script to update the setup
    shell: |
      yes 'qweQWE123!@#' | ./wsha_installer.sh --update
    args:
      chdir: /opt/wsha-full-installer-22.08.0-release-b86/
    become: true

...