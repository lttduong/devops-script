- name: Clean up worker-node
  hosts: localhost
  connection: local
  collections:
  - azure.azcollection
  vars:
    resource_group: open-sanity
    vm_name: worker-node
    vm_disk:
    public_ip: workerIP
  tasks:
  - name: Remove a VM and all resources that were autocreated
    azure_rm_virtualmachine:
      resource_group: "{{ resource_group }}"
      name: "{{ vm_name }}"
      remove_on_absent: all_autocreated
      state: absent
  - name: Remove network interface
    azure_rm_networkinterface:
      resource_group: "{{ resource_group }}"
      name: "{{ vm_name }}"
      state: absent
  - name: Delete public ip
    azure_rm_publicipaddress:
      resource_group: "{{ resource_group }}"
      name: "{{ public_ip }}"
      state: absent
#  - name: Remove managed disk
#    azure_rm_manageddisk:
#      name: mymanageddisk
#      location: eastus
#      resource_group:
#      state: absent
