---
- name: "Initialize CRMQ password facts"
  set_fact:
    generated_crmq_passwords: {}
    passwordLength: 32
    passwordSigns: "%&()*+,-.:;=?@^_"

- debug:
    msg: "Generating passwords for: {{ crmq_password_helm_param_names }}"
    
- name: "Generating CRMQ passwords"
  set_fact:
    generated_crmq_passwords: "{{ generated_crmq_passwords | combine ({ item : (lookup('password', '/dev/null length=1 chars=ascii_uppercase') +
                         lookup('password', '/dev/null length=1 chars=ascii_lowercase') +
                         lookup('password', '/dev/null length=1 chars=digits') +
                         lookup('password', '/dev/null length=1 chars={{ passwordSigns }}') +
                         lookup('password', '/dev/null length={{ passwordLength-4 }}
                                 chars=ascii_letters,digits,{{ passwordSigns }}') | shuffle | join | trim) } ) }}"
  with_items: "{{ crmq_password_helm_param_names }}"
  no_log: true

- name: "Add CRMQ passwords to helm_params"
  set_fact:
    helm_params: "{{ helm_params }} --set {{ item.key }}='{{ item.value }}'"
  with_dict: "{{ generated_crmq_passwords }}"
  no_log: true
  