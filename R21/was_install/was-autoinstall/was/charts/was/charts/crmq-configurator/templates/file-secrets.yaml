{{- range $index, $job:= .Values.jobs }}
{{- if .enabled }}
{{- range list "adminConfig" "adminCommands" "controlCommands" }}
{{- $type := . }}
{{- $entry := index $job $type }}
{{- if ($entry.files) }}
{{- with $ }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ tpl $entry.secretName . }}
  namespace: "{{ .Values.global.BP_CONFIG_NAMESPACE }}"
  labels:
    app: {{ template "name" $ }}
    chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    release: "{{ $.Release.Name }}"
    heritage: "{{ $.Release.Service }}"
  annotations:
    "helm.sh/hook": {{ tpl ( $job.secretHook | default $.Values.global.helmHooks.secret.hook) $ | quote }}
    "helm.sh/hook-weight": {{ tpl ( $job.secretHookWeight | default $.Values.global.helmHooks.secret.weight) $ | quote }}
    "helm.sh/hook-delete-policy": "before-hook-creation"
type: Opaque
data:
{{- range $entry.files }}
  # String the directory off the filename
  {{ regexFind "[^/]+$" . }}: |-
    {{ tpl ($.Files.Get .) $ | b64enc }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
{{- end }}
