---
- name: "Validate GEO redundancy cmdb connection to Active site: {{ GEO_REDUNDANCY.CMDB.REMOTE_DC_ADDRESS }}:{{ mariadbMasterNodePort }}"
  shell: >
    {{ helm }}  upgrade {{ geoRedundancyValidationHelmName }}-{{ item.name }} {{ chartsPath }}/geo-redundancy-validation
    --namespace {{ BP_CONFIG_NAMESPACE }}
    --reuse-values
    --values {{ chartsPath }}/values/upgrade-global-values.yaml
    {{ cmdbResourcesOverride }}
    --set mariadb.host={{ GEO_REDUNDANCY.CMDB.REMOTE_DC_ADDRESS }}
    --set mariadb.port={{ mariadbMasterNodePort }}
    --timeout {{ wait_timeout }}s
    --wait
  with_items:
    - { name: "mariadb" }
    - { name: "maxscale" }
    - { name: "repl" }
    - { name: "keycloak" }
    - { name: "grafana" }
    - { name: "alma" }
  loop_control:
    label: "{{ item.name }}"
  async: "{{ wait_timeout }}"
  poll: 5
  no_log: "{{ no_log }}"
