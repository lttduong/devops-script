---
- name: "Retrieving OS CA certificate"
  shell: >
    kubectl get secret -n {{ certManagerNamespace }} {{ caCertificateSecret }} -o jsonpath='{.data.tls\.crt}'
  register: cert

- name: "Installing OS CA certificate secret in BP namespaces"
  shell: >
    {{ helm }} install {{ chartsPath }}/ca-cert/app
    --name-template {{ caCertHelmName }}-{{ item }}
    --namespace {{ item }}
    --values {{ chartsPath }}/values/global-values.yaml
    --set caCertEncoded="{{ cert.stdout }}"
  with_items:
    - "{{ BP_NAMESPACE }}"
    - "{{ BP_CONFIG_NAMESPACE }}"
