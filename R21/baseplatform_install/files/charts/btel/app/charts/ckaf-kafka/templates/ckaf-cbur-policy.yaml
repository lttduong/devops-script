{{- if .Values.global.cburEnable }}
apiVersion: "cbur.bcmt.local/v1"
kind: BrPolicy
metadata:
  name: {{ template "kafka.name" . }}
  namespace: {{ template "kafka.namespace" . }}
spec:
  selector:
    matchLabels:
      app: {{ .Chart.Name }}
      release: {{ .Release.Name | quote }}
  volumes:
  - topic-backup
  backend:
    mode: "{{ .Values.cbur.backendMode }}"
  cronSpec: "{{ .Values.cbur.cronJob }}"
  k8sType: statefulset
  brOption: 2
  scheduleEnable: true
  maxiCopy: {{ .Values.cbur.maxCopy }} 
  ignoreFileChanged: true
  hooks:
  - name: ckaf-kafka-broker
    commands:
      preBackupCmd: ["sh", "-c", "/etc/kafka/backup-topics.sh"]
      postBackupCmd: ["sh", "-c", "rm -rf /topic-backup/* "]
      preRestoreCmd: []
      postRestoreCmd: ["sh", "-c", "cp -r /topic-backup/* /var/lib/kafka/data/topics/ && rm -rf /topic-backup/*"]
{{- end }} #cburEnable

