# Config map which holds the number of replicas before any scale operation.
# This config map is created and used by pre/post upgrade/rollback jobs to determine 
# the scale in/out direction when the user chooses to use the feature of scale via upgrade jobs. 
{{ if .Values.global.enable_scale_via_upgrade }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "kafka.name" . }}-replicas
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-1"
    "helm.sh/hook-delete-policy": before-hook-creation
    seccomp.security.alpha.kubernetes.io/allowedProfileNames: {{ .Values.global.seccompAllowedProfileNames }}
    seccomp.security.alpha.kubernetes.io/defaultProfileName: {{ .Values.global.seccompDefaultProfileName }}
  labels:
    app: {{ .Chart.Name }}
    release: {{ .Release.Name }}
data:
  replicas: {{ .Values.Replicas | quote }}
{{- end  }}
