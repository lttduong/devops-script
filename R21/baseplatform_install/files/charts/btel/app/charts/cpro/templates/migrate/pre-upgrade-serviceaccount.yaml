{{- if and .Values.rbac.enabled .Values.server.migrate.enabled }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ template "prometheus.serviceAccount.fullname" . }}-pre
  namespace: ncms
{{- if .Values.global.labels }}
  labels:
{{- include "prometheus-labels" (tuple .Values.global.labels) | indent 4}}
{{- end }}
  annotations:
{{- include "prometheus-annotations" (tuple .Values.global.annotations) | indent 4}}
    "helm.sh/hook": pre-upgrade
    "helm.sh/hook-weight": "-6"
    "helm.sh/hook-delete-policy": hook-failed
{{- end }}
