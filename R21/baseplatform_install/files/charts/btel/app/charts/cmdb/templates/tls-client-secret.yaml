{{- if and (.Values.mariadb.use_tls) (eq (default "none" .Values.mariadb.certificates.secret) "cmgr") }}
apiVersion: {{ .Values.certManager.apiVersion }}
kind: Certificate
metadata:
  name: {{ template "cmdb.fullname" . }}-client-cert
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cmdb-mariadb.labels" . | indent 4 }}
spec:
  secretName: {{ template "cmdb.fullname" . }}-client-cert
  issuerRef:
    name: {{ default "ncms-ca-issuer" .Values.certManager.caIssuer.name }}
    kind: ClusterIssuer
  duration: {{ default "8760h" .Values.certManager.duration }}
  renewBefore: {{ default "360h" .Values.certManager.renewBefore }}
  commonName: {{ default ((printf "%s-mariadb" (include "cmdb.fullname" .)) | quote) .Values.certManager.commonName }}
  usages:
    - server auth
    - client auth
#  organization:
#    - Nokia
  dnsNames:
  {{- if .Values.certManager.dnsName1 }}
    - {{ .Values.certManager.dnsName1 }}
  {{- else}}
    - {{ .Release.Namespace }}.svc.{{ .Values.clusterDomain }}
  {{- end }}
  {{- if .Values.certManager.dnsName2 }}
    - {{ .Values.certManager.dnsName2 }}
  {{- end }}
{{- end }}
