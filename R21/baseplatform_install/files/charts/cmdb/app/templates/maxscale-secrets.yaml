## Start of custom chart file
## Note: original file has bug in version 6.7.0 and since it is removed in newer (7.0.3) chart version this file is marked as custom
{{- if gt (int .Values.maxscale.count) 0 }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "cmdb.fullname" . }}-maxscale-secrets
  labels:
    {{- include "cmdb-maxscale.labels" . | indent 4 }}
    ## Start of custom modification of original chart
    backup: "true"
    ## End of custom modification of original chart
  annotations:
    "helm.sh/hook": pre-install
    "helm.sh/hook-weight": "-5"
    "helm.sh/hook-delete-policy": hook-failed

type: Opaque
data:
  maxscale-user: {{ .Values.maxscale.maxscale_user | quote }}
  {{- if .Values.maxscale.maxscale_user_password }}
  maxscale-user-password: {{ .Values.maxscale.maxscale_user_password | quote }}
  {{- else }}
  maxscale-user-password: {{ randAlphaNum 16 | b64enc | quote }}
  {{- end }}
{{- end }}
## End of custom chart file
