{{- if and (.Values.mariadb.use_tls) (eq (default "none" .Values.mariadb.certificates.secret) "cmgr") }}
apiVersion: {{ .Values.certManager.apiVersion }}
kind: Certificate
metadata:
  name: {{ template "cmdb.fullname" . }}-client-cert
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "cmdb-mariadb.labels" . | indent 4 }}
spec:
  secretName: {{ template "cmdb.fullname" . }}-client-cert
  issuerRef:
    name: {{ default "ncms-ca-issuer" .Values.certManager.caIssuer.name }}
    kind: ClusterIssuer
  duration: {{ default "8760h" .Values.certManager.duration }}
  renewBefore: {{ default "360h" .Values.certManager.renewBefore }}
  commonName: {{ default ((printf "%s-mariadb" (include "cmdb.fullname" .)) | quote) .Values.certManager.commonName }}
  usages:
    - server auth
    - client auth
#  organization:
#    - Nokia
  dnsNames:
  ## Start of custom modification of original chart - use the shared service name
  {{ printf "- %s" (include "mysql.service" .) | indent 2 }}
  {{ printf "- %s.%s" (include "mysql.service" .) .Release.Namespace | indent 2 }}
  {{ printf "- %s.%s.%s" (include "mysql.service" .) .Release.Namespace .Values.dns.domain | indent 2 }}
  ## End of custom modification of original chart
{{- end }}
